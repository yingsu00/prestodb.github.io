
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>7.20. Geospatial Functions &#8212; Presto 0.234.2 Documentation</title>
    <link rel="stylesheet" href="../_static/presto.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.234.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7.21. HyperLogLog Functions" href="hyperloglog.html" />
    <link rel="prev" title="7.19. IP Functions" href="ip.html" /> 
  </head>
  <body>
<div class="header">
    <h1 class="heading"><a href="../index.html">
        <span>Presto 0.234.2 Documentation</span></a></h1>
    <h2 class="heading"><span>7.20. Geospatial Functions</span></h2>
</div>
<div class="topnav">
    
<p class="nav">
    <span class="left">
        &laquo; <a href="ip.html">7.19. IP Functions</a>
    </span>
    <span class="right">
        <a href="hyperloglog.html">7.21. HyperLogLog Functions</a> &raquo;
    </span>
</p>

</div>
<div class="content">
    
  <div class="section" id="geospatial-functions">
<h1>7.20. Geospatial Functions</h1>
<p>Presto Geospatial functions that begin with the <code class="docutils literal"><span class="pre">ST_</span></code> prefix support the
SQL/MM specification and are compliant with the Open Geospatial Consortium’s
(OGC) OpenGIS Specifications.  As such, many Presto Geospatial functions
require, or more accurately, assume that geometries that are operated on are
both simple and valid. For example, it does not make sense to calculate the
area of a polygon that has a hole defined outside of the polygon, or to
construct a polygon from a non-simple boundary line.</p>
<p>Presto Geospatial functions support the Well-Known Text (WKT) and Well-Known
Binary (WKB) form of spatial objects:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">POINT</span> <span class="pre">(0</span> <span class="pre">0)</span></code></li>
<li><code class="docutils literal"><span class="pre">LINESTRING</span> <span class="pre">(0</span> <span class="pre">0,</span> <span class="pre">1</span> <span class="pre">1,</span> <span class="pre">1</span> <span class="pre">2)</span></code></li>
<li><code class="docutils literal"><span class="pre">POLYGON</span> <span class="pre">((0</span> <span class="pre">0,</span> <span class="pre">4</span> <span class="pre">0,</span> <span class="pre">4</span> <span class="pre">4,</span> <span class="pre">0</span> <span class="pre">4,</span> <span class="pre">0</span> <span class="pre">0),</span> <span class="pre">(1</span> <span class="pre">1,</span> <span class="pre">2</span> <span class="pre">1,</span> <span class="pre">2</span> <span class="pre">2,</span> <span class="pre">1</span> <span class="pre">2,</span> <span class="pre">1</span> <span class="pre">1))</span></code></li>
<li><code class="docutils literal"><span class="pre">MULTIPOINT</span> <span class="pre">(0</span> <span class="pre">0,</span> <span class="pre">1</span> <span class="pre">2)</span></code></li>
<li><code class="docutils literal"><span class="pre">MULTILINESTRING</span> <span class="pre">((0</span> <span class="pre">0,</span> <span class="pre">1</span> <span class="pre">1,</span> <span class="pre">1</span> <span class="pre">2),</span> <span class="pre">(2</span> <span class="pre">3,</span> <span class="pre">3</span> <span class="pre">2,</span> <span class="pre">5</span> <span class="pre">4))</span></code></li>
<li><code class="docutils literal"><span class="pre">MULTIPOLYGON</span> <span class="pre">(((0</span> <span class="pre">0,</span> <span class="pre">4</span> <span class="pre">0,</span> <span class="pre">4</span> <span class="pre">4,</span> <span class="pre">0</span> <span class="pre">4,</span> <span class="pre">0</span> <span class="pre">0),</span> <span class="pre">(1</span> <span class="pre">1,</span> <span class="pre">2</span> <span class="pre">1,</span> <span class="pre">2</span> <span class="pre">2,</span> <span class="pre">1</span> <span class="pre">2,</span> <span class="pre">1</span> <span class="pre">1)),</span> <span class="pre">((-1</span> <span class="pre">-1,</span> <span class="pre">-1</span> <span class="pre">-2,</span> <span class="pre">-2</span> <span class="pre">-2,</span> <span class="pre">-2</span> <span class="pre">-1,</span> <span class="pre">-1</span> <span class="pre">-1)))</span></code></li>
<li><code class="docutils literal"><span class="pre">GEOMETRYCOLLECTION</span> <span class="pre">(POINT(2</span> <span class="pre">3),</span> <span class="pre">LINESTRING</span> <span class="pre">(2</span> <span class="pre">3,</span> <span class="pre">3</span> <span class="pre">4))</span></code></li>
</ul>
<p>Use <code class="docutils literal"><span class="pre">ST_GeometryFromText</span></code> and <code class="docutils literal"><span class="pre">ST_GeomFromBinary</span></code> functions to create
geometry objects from WKT or WKB.  In WKT/WKB, the coordinate order is
<code class="docutils literal"><span class="pre">(x,</span> <span class="pre">y)</span></code>.  For spherical/geospatial uses, this implies
<code class="docutils literal"><span class="pre">(longitude,</span> <span class="pre">latitude)</span></code> instead of <code class="docutils literal"><span class="pre">(latitude,</span> <span class="pre">longitude)</span></code>.</p>
<p>The basis for the <code class="docutils literal"><span class="pre">Geometry</span></code> type is a plane. The shortest path between two
points on the plane is a straight line. That means calculations on geometries
(areas, distances, lengths, intersections, etc) can be calculated using
cartesian mathematics and straight line vectors.</p>
<p>The <code class="docutils literal"><span class="pre">SphericalGeography</span></code> type provides native support for spatial features
represented on “geographic” coordinates (sometimes called “geodetic”
coordinates, or “lat/lon”, or “lon/lat”). Geographic coordinates are spherical
coordinates expressed in angular units (degrees).</p>
<p>The basis for the <code class="docutils literal"><span class="pre">SphericalGeography</span></code> type is a sphere. The shortest path
between two points on the sphere is a great circle arc. That means that
calculations on geographies (areas, distances, lengths, intersections, etc)
must be calculated on the sphere, using more complicated mathematics. More
accurate measurements that take the actual spheroidal shape of the world into
account are not supported.</p>
<p>For <code class="docutils literal"><span class="pre">SphericalGeography</span></code> objects, values returned by the measurement functions
<code class="docutils literal"><span class="pre">ST_Distance</span></code> and <code class="docutils literal"><span class="pre">ST_Length</span></code> are in the unit of meters; values returned by
<code class="docutils literal"><span class="pre">ST_Area</span></code> are in square meters.</p>
<p>Use <code class="docutils literal"><span class="pre">to_spherical_geography()</span></code> function to convert a geometry object to
geography object.  For example,
<code class="docutils literal"><span class="pre">ST_Distance(ST_Point(-71.0882,</span> <span class="pre">42.3607),</span> <span class="pre">ST_Point(-74.1197,</span> <span class="pre">40.6976))</span></code>
returns 3.4577 in the unit of the passed-in values on the euclidean plane,
while
<code class="docutils literal"><span class="pre">ST_Distance(to_spherical_geography(ST_Point(-71.0882,</span> <span class="pre">42.3607)),</span> <span class="pre">to_spherical_geography(ST_Point(-74.1197,</span> <span class="pre">40.6976)))</span></code>
returns 312822.179 in meters.</p>
<div class="section" id="constructors">
<h2>Constructors</h2>
<dl class="function">
<dt id="ST_AsBinary">
<code class="descname">ST_AsBinary</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; varbinary</dt>
<dd><p>Returns the WKB representation of the geometry.</p>
</dd></dl>

<dl class="function">
<dt id="ST_AsText">
<code class="descname">ST_AsText</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; varchar</dt>
<dd><p>Returns the WKT representation of the geometry. For empty geometries,
<code class="docutils literal"><span class="pre">ST_AsText(ST_LineFromText('LINESTRING</span> <span class="pre">EMPTY'))</span></code> will produce
<code class="docutils literal"><span class="pre">'MULTILINESTRING</span> <span class="pre">EMPTY'</span></code> and <code class="docutils literal"><span class="pre">ST_AsText(ST_Polygon('POLYGON</span> <span class="pre">EMPTY'))</span></code>
will produce <code class="docutils literal"><span class="pre">'MULTIPOLYGON</span> <span class="pre">EMPTY'</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="ST_GeometryFromText">
<code class="descname">ST_GeometryFromText</code><span class="sig-paren">(</span><em>varchar</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns a geometry type object from WKT representation.</p>
</dd></dl>

<dl class="function">
<dt id="ST_GeomFromBinary">
<code class="descname">ST_GeomFromBinary</code><span class="sig-paren">(</span><em>varbinary</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns a geometry type object from WKB representation.</p>
</dd></dl>

<dl class="function">
<dt id="ST_LineFromText">
<code class="descname">ST_LineFromText</code><span class="sig-paren">(</span><em>varchar</em><span class="sig-paren">)</span> &#x2192; LineString</dt>
<dd><p>Returns a geometry type linestring object from WKT representation.</p>
</dd></dl>

<dl class="function">
<dt id="ST_LineString">
<code class="descname">ST_LineString</code><span class="sig-paren">(</span><em>array(Point)</em><span class="sig-paren">)</span> &#x2192; LineString</dt>
<dd><p>Returns a LineString formed from an array of points. If there are fewer
than two non-empty points in the input array, an empty LineString will be
returned.  Throws an exception if any element in the array is <code class="docutils literal"><span class="pre">null</span></code> or
empty or same as the previous one.  The returned geometry may not be
simple, e.g. may self-intersect or may contain duplicate vertexes depending
on the input.</p>
</dd></dl>

<dl class="function">
<dt id="ST_MultiPoint">
<code class="descname">ST_MultiPoint</code><span class="sig-paren">(</span><em>array(Point)</em><span class="sig-paren">)</span> &#x2192; MultiPoint</dt>
<dd><p>Returns a MultiPoint geometry object formed from the specified points.
Return <code class="docutils literal"><span class="pre">null</span></code> if input array is empty.  Throws an exception if any element
in the array is <code class="docutils literal"><span class="pre">null</span></code> or empty.  The returned geometry may not be simple
and may contain duplicate points if input array has duplicates.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Point">
<code class="descname">ST_Point</code><span class="sig-paren">(</span><em>x</em>, <em>y</em><span class="sig-paren">)</span> &#x2192; Point</dt>
<dd><p>Returns a geometry type point object with the given coordinate values.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Polygon">
<code class="descname">ST_Polygon</code><span class="sig-paren">(</span><em>varchar</em><span class="sig-paren">)</span> &#x2192; Polygon</dt>
<dd><p>Returns a geometry type polygon object from WKT representation.</p>
</dd></dl>

<dl class="function">
<dt id="to_spherical_geography">
<code class="descname">to_spherical_geography</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; SphericalGeography</dt>
<dd><p>Converts a Geometry object to a SphericalGeography object on the sphere of
the Earth’s radius. This function is only applicable to <code class="docutils literal"><span class="pre">POINT</span></code>,
<code class="docutils literal"><span class="pre">MULTIPOINT</span></code>, <code class="docutils literal"><span class="pre">LINESTRING</span></code>, <code class="docutils literal"><span class="pre">MULTILINESTRING</span></code>, <code class="docutils literal"><span class="pre">POLYGON</span></code>,
<code class="docutils literal"><span class="pre">MULTIPOLYGON</span></code> geometries defined in 2D space, or <code class="docutils literal"><span class="pre">GEOMETRYCOLLECTION</span></code>
of such geometries. For each point of the input geometry, it verifies that
point.x is within [-180.0, 180.0] and point.y is within [-90.0, 90.0], and
uses them as (longitude, latitude) degrees to construct the shape of the
<code class="docutils literal"><span class="pre">SphericalGeography</span></code> result.</p>
</dd></dl>

<dl class="function">
<dt id="to_geometry">
<code class="descname">to_geometry</code><span class="sig-paren">(</span><em>SphericalGeography</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Converts a SphericalGeography object to a Geometry object.</p>
</dd></dl>

</div>
<div class="section" id="relationship-tests">
<h2>Relationship Tests</h2>
<dl class="function">
<dt id="ST_Contains">
<code class="descname">ST_Contains</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if and only if no points of the second geometry lie in the
exterior of the first geometry, and at least one point of the interior of
the first geometry lies in the interior of the second geometry.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Crosses">
<code class="descname">ST_Crosses</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if the supplied geometries have some, but not all,
interior points in common.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Disjoint">
<code class="descname">ST_Disjoint</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if the give geometries do not <em>spatially intersect</em> – if
they do not share any space together.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Equals">
<code class="descname">ST_Equals</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if the given geometries represent the same geometry.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Intersects">
<code class="descname">ST_Intersects</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if the given geometries spatially intersect in two
dimensions (share any portion of space) and <code class="docutils literal"><span class="pre">false</span></code> if they do not (they
are disjoint).</p>
</dd></dl>

<dl class="function">
<dt id="ST_Overlaps">
<code class="descname">ST_Overlaps</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if the given geometries share space, are of the same
dimension, but are not completely contained by each other.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Relate">
<code class="descname">ST_Relate</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if first geometry is spatially related to second geometry.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Touches">
<code class="descname">ST_Touches</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if the given geometries have at least one point in common,
but their interiors do not intersect.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Within">
<code class="descname">ST_Within</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if first geometry is completely inside second geometry.</p>
</dd></dl>

</div>
<div class="section" id="operations">
<h2>Operations</h2>
<dl class="function">
<dt id="geometry_union">
<code class="descname">geometry_union</code><span class="sig-paren">(</span><em>array(Geometry)</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns a geometry that represents the point set union of the input
geometries. Performance of this function, in conjunction with
<a class="reference internal" href="aggregate.html#array_agg" title="array_agg"><code class="xref py py-func docutils literal"><span class="pre">array_agg()</span></code></a> to first aggregate the input geometries, may be better
than <a class="reference internal" href="#geometry_union_agg" title="geometry_union_agg"><code class="xref py py-func docutils literal"><span class="pre">geometry_union_agg()</span></code></a>, at the expense of higher memory
utilization.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Boundary">
<code class="descname">ST_Boundary</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns the closure of the combinatorial boundary of this geometry.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Buffer">
<code class="descname">ST_Buffer</code><span class="sig-paren">(</span><em>Geometry</em>, <em>distance</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns the geometry that represents all points whose distance from the
specified geometry is less than or equal to the specified distance.  If the
points of the geometry are extremely close together (<code class="docutils literal"><span class="pre">delta</span> <span class="pre">&lt;</span> <span class="pre">1e-8</span></code>), this
might return an empty geometry.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Difference">
<code class="descname">ST_Difference</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns the geometry value that represents the point set difference of the
given geometries.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Envelope">
<code class="descname">ST_Envelope</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns the bounding rectangular polygon of a geometry.</p>
</dd></dl>

<dl class="function">
<dt id="ST_EnvelopeAsPts">
<code class="descname">ST_EnvelopeAsPts</code><span class="sig-paren">(</span><em>Geometry) -&gt; array(Geometry</em><span class="sig-paren">)</span></dt>
<dd><p>Returns an array of two points: the lower left and upper right corners of
the bounding rectangular polygon of a geometry. Returns <code class="docutils literal"><span class="pre">null</span></code> if input
geometry is empty.</p>
</dd></dl>

<dl class="function">
<dt id="expand_envelope">
<code class="descname">expand_envelope</code><span class="sig-paren">(</span><em>Geometry</em>, <em>double</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns the bounding rectangular polygon of a geometry, expanded by a
distance. Empty geometries will return an empty polygon.  Negative or NaN
distances will return an error.  Positive infinity distances may lead to
undefined results.</p>
</dd></dl>

<dl class="function">
<dt id="ST_ExteriorRing">
<code class="descname">ST_ExteriorRing</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns a line string representing the exterior ring of the input polygon.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Intersection">
<code class="descname">ST_Intersection</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns the geometry value that represents the point set intersection of
two geometries.</p>
</dd></dl>

<dl class="function">
<dt id="ST_SymDifference">
<code class="descname">ST_SymDifference</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns the geometry value that represents the point set symmetric
difference of two geometries.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Union">
<code class="descname">ST_Union</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns a geometry that represents the point set union of the input
geometries.</p>
<p>See also:  <a class="reference internal" href="#geometry_union" title="geometry_union"><code class="xref py py-func docutils literal"><span class="pre">geometry_union()</span></code></a>, <a class="reference internal" href="#geometry_union_agg" title="geometry_union_agg"><code class="xref py py-func docutils literal"><span class="pre">geometry_union_agg()</span></code></a></p>
</dd></dl>

</div>
<div class="section" id="accessors">
<h2>Accessors</h2>
<dl class="function">
<dt id="ST_Area">
<code class="descname">ST_Area</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Returns the 2D Euclidean area of a geometry.</p>
<p>For Point and LineString types, returns 0.0.
For GeometryCollection types, returns the sum of the areas of the individual
geometries.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">ST_Area</code><span class="sig-paren">(</span><em>SphericalGeography</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Returns the area of a polygon or multi-polygon in square meters using a spherical model for Earth.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Centroid">
<code class="descname">ST_Centroid</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; Point</dt>
<dd><p>Returns the point value that is the mathematical centroid of a geometry.</p>
</dd></dl>

<dl class="function">
<dt id="ST_ConvexHull">
<code class="descname">ST_ConvexHull</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns the minimum convex geometry that encloses all input geometries.</p>
</dd></dl>

<dl class="function">
<dt id="ST_CoordDim">
<code class="descname">ST_CoordDim</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; bigint</dt>
<dd><p>Return the coordinate dimension of the geometry.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Dimension">
<code class="descname">ST_Dimension</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; bigint</dt>
<dd><p>Returns the inherent dimension of this geometry object, which must be
less than or equal to the coordinate dimension.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Distance">
<code class="descname">ST_Distance</code><span class="sig-paren">(</span><em>Geometry</em>, <em>Geometry</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Returns the 2-dimensional cartesian minimum distance (based on spatial ref)
between two geometries in projected units.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">ST_Distance</code><span class="sig-paren">(</span><em>SphericalGeography</em>, <em>SphericalGeography</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Returns the great-circle distance in meters between two SphericalGeography points.</p>
</dd></dl>

<dl class="function">
<dt id="ST_GeometryN">
<code class="descname">ST_GeometryN</code><span class="sig-paren">(</span><em>Geometry</em>, <em>index</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns the geometry element at a given index (indices start at 1).
If the geometry is a collection of geometries (e.g., GEOMETRYCOLLECTION or MULTI*),
returns the geometry at a given index.
If the given index is less than 1 or greater than the total number of elements in the collection,
returns <code class="docutils literal"><span class="pre">NULL</span></code>.
Use :func:<code class="docutils literal"><span class="pre">ST_NumGeometries</span></code> to find out the total number of elements.
Singular geometries (e.g., POINT, LINESTRING, POLYGON), are treated as collections of one element.
Empty geometries are treated as empty collections.</p>
</dd></dl>

<dl class="function">
<dt id="ST_InteriorRingN">
<code class="descname">ST_InteriorRingN</code><span class="sig-paren">(</span><em>Geometry</em>, <em>index</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns the interior ring element at the specified index (indices start at 1). If
the given index is less than 1 or greater than the total number of interior rings
in the input geometry, returns <code class="docutils literal"><span class="pre">NULL</span></code>. Throws an error if the input geometry is
not a polygon.
Use :func:<code class="docutils literal"><span class="pre">ST_NumInteriorRing</span></code> to find out the total number of elements.</p>
</dd></dl>

<dl class="function">
<dt id="ST_GeometryType">
<code class="descname">ST_GeometryType</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; varchar</dt>
<dd><p>Returns the type of the geometry.</p>
</dd></dl>

<dl class="function">
<dt id="ST_IsClosed">
<code class="descname">ST_IsClosed</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if the linestring’s start and end points are coincident.</p>
</dd></dl>

<dl class="function">
<dt id="ST_IsEmpty">
<code class="descname">ST_IsEmpty</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if this Geometry is an empty geometrycollection, polygon, point etc.</p>
</dd></dl>

<dl class="function">
<dt id="ST_IsSimple">
<code class="descname">ST_IsSimple</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if this Geometry has no anomalous geometric points, such as self intersection or self tangency.
Use <a class="reference internal" href="#geometry_invalid_reason" title="geometry_invalid_reason"><code class="xref py py-func docutils literal"><span class="pre">geometry_invalid_reason()</span></code></a> to determine why the geometry is not simple.</p>
</dd></dl>

<dl class="function">
<dt id="ST_IsRing">
<code class="descname">ST_IsRing</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if and only if the line is closed and simple.</p>
</dd></dl>

<dl class="function">
<dt id="ST_IsValid">
<code class="descname">ST_IsValid</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; boolean</dt>
<dd><p>Returns <code class="docutils literal"><span class="pre">true</span></code> if and only if the input geometry is well formed.
Use <a class="reference internal" href="#geometry_invalid_reason" title="geometry_invalid_reason"><code class="xref py py-func docutils literal"><span class="pre">geometry_invalid_reason()</span></code></a> to determine why the geometry is not well formed.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Length">
<code class="descname">ST_Length</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Returns the length of a linestring or multi-linestring using Euclidean measurement on a
two dimensional plane (based on spatial ref) in projected units.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">ST_Length</code><span class="sig-paren">(</span><em>SphericalGeography</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Returns the length of a linestring or multi-linestring on a spherical model of the Earth.
This is equivalent to the sum of great-circle distances between adjacent points on the linestring.</p>
</dd></dl>

<dl class="function">
<dt id="ST_PointN">
<code class="descname">ST_PointN</code><span class="sig-paren">(</span><em>LineString</em>, <em>index</em><span class="sig-paren">)</span> &#x2192; Point</dt>
<dd><p>Returns the vertex of a linestring at a given index (indices start at 1).
If the given index is less than 1 or greater than the total number of elements in the collection,
returns <code class="docutils literal"><span class="pre">NULL</span></code>.
Use :func:<code class="docutils literal"><span class="pre">ST_NumPoints</span></code> to find out the total number of elements.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Points">
<code class="descname">ST_Points</code><span class="sig-paren">(</span><em>Geometry) -&gt; array(Point</em><span class="sig-paren">)</span></dt>
<dd><p>Returns an array of points in a linestring.</p>
</dd></dl>

<dl class="function">
<dt id="ST_XMax">
<code class="descname">ST_XMax</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Returns the X maximum of the geometry’s bounding box.</p>
</dd></dl>

<dl class="function">
<dt id="ST_YMax">
<code class="descname">ST_YMax</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Returns the Y maximum of the geometry’s bounding box.</p>
</dd></dl>

<dl class="function">
<dt id="ST_XMin">
<code class="descname">ST_XMin</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Returns the X minimum of the geometry’s bounding box.</p>
</dd></dl>

<dl class="function">
<dt id="ST_YMin">
<code class="descname">ST_YMin</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Returns the Y minimum of the geometry’s bounding box.</p>
</dd></dl>

<dl class="function">
<dt id="ST_StartPoint">
<code class="descname">ST_StartPoint</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; point</dt>
<dd><p>Returns the first point of a LineString geometry as a Point.
This is a shortcut for <code class="docutils literal"><span class="pre">ST_PointN(geometry,</span> <span class="pre">1)</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="ST_EndPoint">
<code class="descname">ST_EndPoint</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; point</dt>
<dd><p>Returns the last point of a LineString geometry as a Point.
This is a shortcut for <code class="docutils literal"><span class="pre">ST_PointN(geometry,</span> <span class="pre">ST_NumPoints(geometry))</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="ST_X">
<code class="descname">ST_X</code><span class="sig-paren">(</span><em>Point</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Return the X coordinate of the point.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Y">
<code class="descname">ST_Y</code><span class="sig-paren">(</span><em>Point</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Return the Y coordinate of the point.</p>
</dd></dl>

<dl class="function">
<dt id="ST_InteriorRings">
<code class="descname">ST_InteriorRings</code><span class="sig-paren">(</span><em>Geometry) -&gt; array(Geometry</em><span class="sig-paren">)</span></dt>
<dd><p>Returns an array of all interior rings found in the input geometry, or an empty
array if the polygon has no interior rings. Returns <code class="docutils literal"><span class="pre">null</span></code> if the input geometry
is empty. Throws an error if the input geometry is not a polygon.</p>
</dd></dl>

<dl class="function">
<dt id="ST_NumGeometries">
<code class="descname">ST_NumGeometries</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; bigint</dt>
<dd><p>Returns the number of geometries in the collection.
If the geometry is a collection of geometries (e.g., GEOMETRYCOLLECTION or
MULTI*), returns the number of geometries, for single geometries returns 1,
for empty geometries returns 0.  Note that empty geometries inside of a
GEOMETRYCOLLECTION will count as a geometry; eg
<code class="docutils literal"><span class="pre">ST_NumGeometries(ST_GeometryFromText('GEOMETRYCOLLECTION(MULTIPOINT</span> <span class="pre">EMPTY)'))</span></code>
will evaluate to 1.</p>
</dd></dl>

<dl class="function">
<dt id="ST_Geometries">
<code class="descname">ST_Geometries</code><span class="sig-paren">(</span><em>Geometry) -&gt; array(Geometry</em><span class="sig-paren">)</span></dt>
<dd><p>Returns an array of geometries in the specified collection. Returns a one-element array
if the input geometry is not a multi-geometry. Returns <code class="docutils literal"><span class="pre">null</span></code> if input geometry is empty.</p>
<p>For example, a MultiLineString will create an array of LineStrings.  A GeometryCollection
will produce an un-flattened array of its constituents:
<code class="docutils literal"><span class="pre">GEOMETRYCOLLECTION(MULTIPOINT(0</span> <span class="pre">0,</span> <span class="pre">1</span> <span class="pre">1),</span> <span class="pre">GEOMETRYCOLLECTION(MULTILINESTRING((2</span> <span class="pre">2,</span> <span class="pre">3</span> <span class="pre">3))))</span></code>
would produce <code class="docutils literal"><span class="pre">array[MULTIPOINT(0</span> <span class="pre">0,</span> <span class="pre">1</span> <span class="pre">1),</span> <span class="pre">GEOMETRYCOLLECTION(MULTILINESTRING((2</span> <span class="pre">2,</span> <span class="pre">3</span> <span class="pre">3)))]</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="ST_NumPoints">
<code class="descname">ST_NumPoints</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; bigint</dt>
<dd><p>Returns the number of points in a geometry. This is an extension to the SQL/MM
<code class="docutils literal"><span class="pre">ST_NumPoints</span></code> function which only applies to point and linestring.</p>
</dd></dl>

<dl class="function">
<dt id="ST_NumInteriorRing">
<code class="descname">ST_NumInteriorRing</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; bigint</dt>
<dd><p>Returns the cardinality of the collection of interior rings of a polygon.</p>
</dd></dl>

<dl class="function">
<dt id="simplify_geometry">
<code class="descname">simplify_geometry</code><span class="sig-paren">(</span><em>Geometry</em>, <em>double</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns a “simplified” version of the input geometry using the Douglas-Peucker algorithm.
Will avoid creating derived geometries (polygons in particular) that are invalid.</p>
</dd></dl>

<dl class="function">
<dt id="line_locate_point">
<code class="descname">line_locate_point</code><span class="sig-paren">(</span><em>LineString</em>, <em>Point</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Returns a float between 0 and 1 representing the location of the closest point on
the LineString to the given Point, as a fraction of total 2d line length.</p>
<p>Returns <code class="docutils literal"><span class="pre">null</span></code> if a LineString or a Point is empty or <code class="docutils literal"><span class="pre">null</span></code>.</p>
</dd></dl>

<dl class="function">
<dt id="line_interpolate_point">
<code class="descname">line_interpolate_point</code><span class="sig-paren">(</span><em>LineString</em>, <em>double</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns the Point on the LineString at a fractional distance given by the
double argument.  Throws an exception if the distance is not between 0 and 1.</p>
<p>Returns an empty Point if the LineString is empty.  Returns <code class="docutils literal"><span class="pre">null</span></code> if
either the LineString or double is null.</p>
</dd></dl>

<dl class="function">
<dt id="geometry_invalid_reason">
<code class="descname">geometry_invalid_reason</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; varchar</dt>
<dd><p>Returns the reason for why the input geometry is not valid or not simple.
If the geometry is neither valid no simple, it will only give the reason
for invalidity.
Returns <code class="docutils literal"><span class="pre">null</span></code> if the input is valid and simple.</p>
</dd></dl>

<dl class="function">
<dt id="great_circle_distance">
<code class="descname">great_circle_distance</code><span class="sig-paren">(</span><em>latitude1</em>, <em>longitude1</em>, <em>latitude2</em>, <em>longitude2</em><span class="sig-paren">)</span> &#x2192; double</dt>
<dd><p>Returns the great-circle distance between two points on Earth’s surface in kilometers.</p>
</dd></dl>

</div>
<div class="section" id="aggregations">
<h2>Aggregations</h2>
<dl class="function">
<dt id="convex_hull_agg">
<code class="descname">convex_hull_agg</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns the minimum convex geometry that encloses all input geometries.</p>
</dd></dl>

<dl class="function">
<dt id="geometry_union_agg">
<code class="descname">geometry_union_agg</code><span class="sig-paren">(</span><em>Geometry</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns a geometry that represents the point set union of all input geometries.</p>
</dd></dl>

</div>
<div class="section" id="bing-tiles">
<h2>Bing Tiles</h2>
<p>These functions convert between geometries and
<a class="reference external" href="https://msdn.microsoft.com/en-us/library/bb259689.aspx">Bing tiles</a>.  For
Bing tiles, <code class="docutils literal"><span class="pre">x</span></code> and <code class="docutils literal"><span class="pre">y</span></code> refer to <code class="docutils literal"><span class="pre">tile_x</span></code> and <code class="docutils literal"><span class="pre">tile_y</span></code>.  Bing Tiles
can be cast to and from BigInts, using an internal representation that encodes
the <code class="docutils literal"><span class="pre">zoom</span></code>, <code class="docutils literal"><span class="pre">x</span></code>, and <code class="docutils literal"><span class="pre">y</span></code> efficiently:</p>
<div class="highlight-sql"><div class="highlight"><pre><span></span><span class="k">cast</span><span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="n">tile</span> <span class="k">AS</span> <span class="nb">BIGINT</span><span class="p">)</span> <span class="k">AS</span> <span class="n">BINGTILE</span><span class="p">)</span>
</pre></div>
</div>
<p>While every tile can be cast to a bigint, casting from a bigint that does not
represent a valid tile will raise an exception.</p>
<dl class="function">
<dt id="bing_tile">
<code class="descname">bing_tile</code><span class="sig-paren">(</span><em>x</em>, <em>y</em>, <em>zoom_level</em><span class="sig-paren">)</span> &#x2192; BingTile</dt>
<dd><p>Creates a Bing tile object from XY coordinates and a zoom level.
Zoom levels from 1 to 23 are supported.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">bing_tile</code><span class="sig-paren">(</span><em>quadKey</em><span class="sig-paren">)</span> &#x2192; BingTile</dt>
<dd><p>Creates a Bing tile object from a quadkey.</p>
</dd></dl>

<dl class="function">
<dt id="bing_tile_at">
<code class="descname">bing_tile_at</code><span class="sig-paren">(</span><em>latitude</em>, <em>longitude</em>, <em>zoom_level</em><span class="sig-paren">)</span> &#x2192; BingTile</dt>
<dd><p>Returns a Bing tile at a given zoom level containing a point at a given latitude
and longitude. Latitude must be within <code class="docutils literal"><span class="pre">[-85.05112878,</span> <span class="pre">85.05112878]</span></code> range.
Longitude must be within <code class="docutils literal"><span class="pre">[-180,</span> <span class="pre">180]</span></code> range. Zoom levels from 1 to 23 are supported.</p>
</dd></dl>

<dl class="function">
<dt id="bing_tiles_around">
<code class="descname">bing_tiles_around</code><span class="sig-paren">(</span><em>latitude</em>, <em>longitude</em>, <em>zoom_level) -&gt; array(BingTile</em><span class="sig-paren">)</span></dt>
<dd><p>Returns a collection of Bing tiles that surround the point specified
by the latitude and longitude arguments at a given zoom level.</p>
</dd></dl>

<dl class="function">
<dt>
<code class="descname">bing_tiles_around</code><span class="sig-paren">(</span><em>latitude</em>, <em>longitude</em>, <em>zoom_level</em>, <em>radius_in_km) -&gt; array(BingTile</em><span class="sig-paren">)</span></dt>
<dd><p>Returns a minimum set of Bing tiles at specified zoom level that cover a circle of specified
radius in km around a specified (latitude, longitude) point.</p>
</dd></dl>

<dl class="function">
<dt id="bing_tile_coordinates">
<code class="descname">bing_tile_coordinates</code><span class="sig-paren">(</span><em>tile</em><span class="sig-paren">)</span> &#x2192; row&lt;x, y&gt;</dt>
<dd><p>Returns the XY coordinates of a given Bing tile.</p>
</dd></dl>

<dl class="function">
<dt id="bing_tile_polygon">
<code class="descname">bing_tile_polygon</code><span class="sig-paren">(</span><em>tile</em><span class="sig-paren">)</span> &#x2192; Geometry</dt>
<dd><p>Returns the polygon representation of a given Bing tile.</p>
</dd></dl>

<dl class="function">
<dt id="bing_tile_quadkey">
<code class="descname">bing_tile_quadkey</code><span class="sig-paren">(</span><em>tile</em><span class="sig-paren">)</span> &#x2192; varchar</dt>
<dd><p>Returns the quadkey of a given Bing tile.</p>
</dd></dl>

<dl class="function">
<dt id="bing_tile_zoom_level">
<code class="descname">bing_tile_zoom_level</code><span class="sig-paren">(</span><em>tile</em><span class="sig-paren">)</span> &#x2192; tinyint</dt>
<dd><p>Returns the zoom level of a given Bing tile.</p>
</dd></dl>

<dl class="function">
<dt id="geometry_to_bing_tiles">
<code class="descname">geometry_to_bing_tiles</code><span class="sig-paren">(</span><em>geometry</em>, <em>zoom_level) -&gt; array(BingTile</em><span class="sig-paren">)</span></dt>
<dd><p>Returns the minimum set of Bing tiles that fully covers a given geometry at
a given zoom level. Zoom levels from 1 to 23 are supported.</p>
</dd></dl>

</div>
</div>


</div>
<div class="bottomnav">
    
<p class="nav">
    <span class="left">
        &laquo; <a href="ip.html">7.19. IP Functions</a>
    </span>
    <span class="right">
        <a href="hyperloglog.html">7.21. HyperLogLog Functions</a> &raquo;
    </span>
</p>

</div>

    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>